name: httpbin smoke
baseUrl: ${ENV:HTTPBIN_BASE_URL}
vars:
  token: demo123
  HTTPBIN_BASE_URL: https://httpbin.org

tests:
  - name: GET status 200
    stage: 0
    request:
      method: GET
      url: /status/200
    assert:
      status: 200
      maxDurationMs: 3000

  - name: echo headers
    stage: 0
    request:
      method: GET
      url: /headers
      headers:
        Authorization: "Bearer ${token}"
    assert:
      status: 200
      jsonContains:
        headers.Authorization: "Bearer ${token}"

  - name: post json and extract
    stage: 0
    request:
      method: POST
      url: /anything
      body:
        user: qa
        id: 42
    assert:
      status: 200
      jsonEquals:
        json.user: qa
        json.id: "42"
    extract:
      echoedUser:
        jsonPath: json.user

  - name: reuse extracted var
    stage: 1
    request:
      method: POST
      url: /anything
      body:
        who: "${echoedUser}"
    assert:
      status: 200
      jsonEquals:
        json.who: qa
